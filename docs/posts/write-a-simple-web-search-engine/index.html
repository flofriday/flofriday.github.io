<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Write a simple Web Search Engine | flofriday</title>

<meta name="keywords" content="" />
<meta name="description" content="A Web Search Engine consists basically of two parts, a crawler that downloads Websites and builds an index on their words, and an application to use for the endusers (usually a webserver) with an query-engine that uses the index created by the crawler.
In this post we will write a very simple crawler and a minimal webserver that allows the user to find all websites in the index that contain a (single word) searchterm.">
<meta name="author" content="">
<link rel="canonical" href="http://flofriday.github.io/posts/write-a-simple-web-search-engine/" />
<link href="/assets/css/stylesheet.min.1eef9c740af75b4e5f773d9d5f757e03e3df71f3a308e73070cc73d55a59a7d7.css" integrity="sha256-Hu&#43;cdAr3W05fdz2dX3V&#43;A&#43;PfcfOjCOcwcMxz1VpZp9c=" rel="preload stylesheet"
    as="style">

<link rel="icon" href="http://flofriday.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://flofriday.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://flofriday.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://flofriday.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="http://flofriday.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.81.0" />


<meta property="og:title" content="Write a simple Web Search Engine" />
<meta property="og:description" content="A Web Search Engine consists basically of two parts, a crawler that downloads Websites and builds an index on their words, and an application to use for the endusers (usually a webserver) with an query-engine that uses the index created by the crawler.
In this post we will write a very simple crawler and a minimal webserver that allows the user to find all websites in the index that contain a (single word) searchterm." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://flofriday.github.io/posts/write-a-simple-web-search-engine/" />
<meta property="article:published_time" content="2021-02-25T00:14:36+01:00" />
<meta property="article:modified_time" content="2021-02-25T00:14:36+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Write a simple Web Search Engine"/>
<meta name="twitter:description" content="A Web Search Engine consists basically of two parts, a crawler that downloads Websites and builds an index on their words, and an application to use for the endusers (usually a webserver) with an query-engine that uses the index created by the crawler.
In this post we will write a very simple crawler and a minimal webserver that allows the user to find all websites in the index that contain a (single word) searchterm."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "http://flofriday.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Write a simple Web Search Engine",
      "item": "http://flofriday.github.io/posts/write-a-simple-web-search-engine/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Write a simple Web Search Engine",
  "name": "Write a simple Web Search Engine",
  "description": "A Web Search Engine consists basically of two parts, a crawler that downloads Websites and builds an index on their words, and an application to use for the endusers (usually a …",
  "keywords": [
    
  ],
  "articleBody": "A Web Search Engine consists basically of two parts, a crawler that downloads Websites and builds an index on their words, and an application to use for the endusers (usually a webserver) with an query-engine that uses the index created by the crawler.\nIn this post we will write a very simple crawler and a minimal webserver that allows the user to find all websites in the index that contain a (single word) searchterm.\nThe goal is not to build anything remotly as powerfull as Google, Bing or DuckDuckGo, but to create a simple codebase to start hacking on. For this blog we will use Golang, however it should be easy to follow along with any other language.\nA simple (inverted) index The inverted index is the hearth of every search engine. A normal index (also known as forward index) maps a document to its content. With a search engine however the user knows a piece of the content and wants to know in which document it appears. An inverted index does exactly that, mapping the content to a list of documents. From now on I will refer to this as just “the index”.\nThe most basic index build be a HashTable(Dictionary) mapping a word to a list of URLs in which it appears.\n1 2 3  index := make(map[string][]string) index[\"linux\"] = []string{\"https://en.wikipedia.org/wiki/Linux\"} index[\"torvalds\"] = []string{\"https://en.wikipedia.org/wiki/Linux\"}   While this would work as an index, we want to improve two things about it. First, it is kind of a waste to store the whole string of the url with every word. A quick fix would be to store a pointer to the string with a HashTable like this map[string][]*string. While this would help with the memory footprint, it would still result in the same wasteful representation when writing the datastructure to disk. Therefor the better solution is to create a second list for the documents and in the table for the words we just save the index of the document.\nSecond, we want to avoid duplicated documents for a word so we should replace the list of documentids with a set. (Note: as Go has no native set type I will be using a map[int]bool as a replacement.)\n1 2 3 4 5 6 7 8 9 10 11 12 13  docsIndex := []string{ \"https://en.wikipedia.org/wiki/Linux\", \"https://en.wikipedia.org/wiki/Microsoft_Windows\", } wordsIndex := make(map([string]map[int]bool)) { \"gates\": map[int]bool{ 0: true, }, \"torvalds\": map[int]bool{ 0: true, 1: true, }, }   Finally, we should put this code into its own package so that the crawler and server binaries can both use it without code duplication. While we are at it, we could define a new Index struct and add methods for adding documents, resolving single word query and reading and writing from disk.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66  // index.go package index import ( \"encoding/json\" \"io/ioutil\" ) type Index struct { Docs []string Words map[string]map[int]bool } // Create a new empty index func New() *Index { return \u0026Index{} } // Load an existing index from disk func Load(path string) (*Index, error) { data, err := ioutil.ReadFile(\"index.json\") if err != nil { return nil, err } index := Index{} err = json.Unmarshal(data, \u0026index) return \u0026index, err } // Add a document to the index func (i *Index) AddDoc(url string, words []string) { docId := len(i.Docs) i.Docs = append(i.Docs, url) for _, word := range words { if _, ok := i.Words[word]; !ok { i.Words[word] = map[int]bool{docId: true} continue } i.Words[word][docId] = true } } // Retreive all documents that mention a word func (i *Index) GetDocs(word string) []string { if _, ok := i.Words[word]; !ok { return []string{} } docs := make([]string, 0, len(i.Words[word])) for id, _ := range i.Words[word] { docs = append(docs, i.Docs[id]) } return docs } // Save the index to disk func (i *Index) Save() error { data, err := json.Marshal(i) if err != nil { return err } err = ioutil.WriteFile(\"index.json\", data, 0666) return err }   Before moving on to the crawler, I want to mention that this simple index has many drawbacks.\n  The index cannot solve exact matches (in Google this can be achieved to put double quotes around a phrase) as our index doesn’t save where words appear.\n  Saving the index as json is not quite as efficient as it could be with a custom file format, but was used here for simplicity.\n  The index is not scalable as whole thing has to fit into memmory, is at the moment not thread-save and cannot easily be spread over multiple processes/computers.\n  Every website is just represented by its URL, which means this is all we can show the user as a result, no websites title, no sniped where the searchterm appears just the URL.\n  The crawler Now that we have created the structure of the index, we need to write a program to build said index. A Web crawler starts at a website (this one is called the seed), downloads it, extracts all links to other websites, adds them to a waitingqueue and then repeats with new URL from the queue.\nThis way of discovering new websites works quite well, actually it works too good. For example the Linux Wikipedia page has over 1700 hyperlinks, if each of them has again 1700 links we would have visited almost three milion websites. While this example might be somewhat extreme, it shows the point that we need to limit the crawler artificially.\nThere are some quite creative ways to limit the crawler. For example we could limit the websites we visited to a single URL like bbc.com or let the crawler just allow to visit Austria domains which all end in .at. For now, however, we will only limit the number of websited the crawler can visit.\nSo with that said our main loop looks something like that:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  // cmd/crawler/main.go  func main() { index := index.New() queue := []string{\"https://en.wikipedia.org/wiki/Linux\"} visited := make(map[string]bool) limit := 100 client := http.Client{ Timeout: time.Second * 10, } for len(visited) limit \u0026\u0026 len(queue)  0 { url, queue := queue[0], queue[1:] if _, ok := visited[url]; ok { // already visited that url \tcontinue } resp, err := client.Get(url) if err != nil { log.Printf(\"Unable to download %s: %s\", url, err.Error()) continue } defer resp.Body.Close() log.Printf(\"Downloaded %s\", url) visited[url] = true links, words := extractData(url, resp.Body) index.addDoc(url, words) queue = append(queue, links...) } }   In this code snipet we used a new function we haven’t talked about: extractData(). This function extracts hyperlinks and text from a webpage. Unfortunatly this means we need to parse HTML which is non-trivial and correct parsing would exceed the limit of this blog. Luckily this problem is quite common and there are libraries for almost any programming language that can parse HTML:\n Golang: goquery Python: beautifulsoup4 Node.js: jsdom Rust: html5ever  If you cannot find a library or don’t want to use the one, you can still achive the most basic results with regular expressions.\nWith goquery the extract function the complete crawler looks something like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48  // cmd/crawler/main.go package main import ( \"io\" \"log\" \"net/http\" \"net/url\" \"strings\" \"time\" \"github.com/PuerkitoBio/goquery\" \"github.com/flofriday/websearchblog/index\" // Change this line ) func extractData(baseUrl string, body io.Reader) ([]string, []string) { base, _ := url.Parse(baseUrl) doc, err := goquery.NewDocumentFromReader(body) if err != nil { return []string{}, []string{} } links := []string{} doc.Find(\"a\").Each(func(i int, el *goquery.Selection) { href, exists := el.Attr(\"href\") if !exists { return } link, err := url.Parse(href) if err != nil { return } link = base.ResolveReference(link) link.Fragment = \"\" links = append(links, link.String()) }) doc.Find(\"script style\").Each(func(i int, el *goquery.Selection) { el.Remove() }) words := strings.Fields(doc.Text()) return links, words } func main() { ... }   The webserver Next steps ",
  "wordCount" : "1410",
  "inLanguage": "en",
  "datePublished": "2021-02-25T00:14:36+01:00",
  "dateModified": "2021-02-25T00:14:36+01:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://flofriday.github.io/posts/write-a-simple-web-search-engine/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "flofriday",
    "logo": {
      "@type": "ImageObject",
      "url": "http://flofriday.github.io/favicon.ico"
    }
  }
}
</script>





</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>
<noscript>
    <style type="text/css">
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://flofriday.github.io" accesskey="h" title="flofriday (Alt + H)">flofriday</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                
                
            </span>
        </div>
        <ul id="menu" onscroll="menu_on_scroll()">
            <li>
                <a href="http://flofriday.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li></ul>
    </nav>
</header>

    <main class="main">

<article class="post-single">
  <header class="post-header">

    <h1 class="post-title">
      Write a simple Web Search Engine
    </h1>
    <div class="post-meta">February 25, 2021&nbsp;·&nbsp;7 min

</div>
  </header> 

  <div class="post-content">
<p><img src="/images/bananasearch1.png" alt="BananaSearchScreenshot"></p>
<p>A Web Search Engine consists basically of two parts, a crawler that downloads
Websites and builds an index on their words, and an application to use for the
endusers (usually a webserver) with an query-engine that uses the index created
by the crawler.</p>
<p>In this post we will write a very simple crawler and a minimal webserver that
allows the user to find all websites in the index that contain a (single word)
searchterm.</p>
<p>The goal is not to build anything remotly as powerfull as Google, Bing or
DuckDuckGo, but to create a simple codebase to start hacking on. For this blog
we will use <a href="https://golang.org/">Golang</a>, however it should be easy to follow
along with any other language.</p>
<h1 id="a-simple-inverted-index">A simple (inverted) index<a hidden class="anchor" aria-hidden="true" href="#a-simple-inverted-index">#</a></h1>
<p>The <a href="https://en.wikipedia.org/wiki/Inverted_index">inverted index</a>
is the hearth of every search engine. A normal index (also
known as forward index) maps a document to its content. With a search engine
however the user knows a piece of the content and wants to know in which
document it appears. An inverted index does exactly that, mapping the content to
a list of documents. From now on I will refer to this as just &ldquo;the index&rdquo;.</p>
<p>The most basic index build be a HashTable(Dictionary) mapping a word to a list of
URLs in which it appears.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">index</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>][]<span style="color:#66d9ef">string</span>)
<span style="color:#a6e22e">index</span>[<span style="color:#e6db74">&#34;linux&#34;</span>] = []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;https://en.wikipedia.org/wiki/Linux&#34;</span>}
<span style="color:#a6e22e">index</span>[<span style="color:#e6db74">&#34;torvalds&#34;</span>] = []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;https://en.wikipedia.org/wiki/Linux&#34;</span>}
</code></pre></td></tr></table>
</div>
</div><p>While this would work as an index, we want to improve two things about it.
First, it is kind of a waste to store the whole string of the url with every
word. A quick fix would be to store a pointer to the string with a HashTable
like this <code>map[string][]*string</code>. While this would help with the memory
footprint, it would still result in the same wasteful representation when
writing the datastructure to disk. Therefor the better solution is to create
a second list for the documents and in the table for the words we just save
the index of the document.</p>
<p>Second, we want to avoid duplicated documents for a word so we should replace
the list of documentids with a set. (<code>Note:</code> as Go has no native set type
I will be using a <code>map[int]bool</code> as a replacement.)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#a6e22e">docsIndex</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{
    <span style="color:#e6db74">&#34;https://en.wikipedia.org/wiki/Linux&#34;</span>,
    <span style="color:#e6db74">&#34;https://en.wikipedia.org/wiki/Microsoft_Windows&#34;</span>,
}
<span style="color:#a6e22e">wordsIndex</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>([<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#66d9ef">bool</span>)) {
    <span style="color:#e6db74">&#34;gates&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#66d9ef">bool</span>{
        <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">true</span>,
    },
    <span style="color:#e6db74">&#34;torvalds&#34;</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#66d9ef">bool</span>{
        <span style="color:#ae81ff">0</span>: <span style="color:#66d9ef">true</span>,
        <span style="color:#ae81ff">1</span>: <span style="color:#66d9ef">true</span>,
    },
}
</code></pre></td></tr></table>
</div>
</div><p>Finally, we should put this code into its own package so that the crawler and
server binaries can both use it without code duplication. While we are at it,
we could define a new <code>Index</code> struct and add methods for adding documents,
resolving single word query and reading and writing from disk.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">// index.go
</span><span style="color:#75715e"></span><span style="color:#f92672">package</span> <span style="color:#a6e22e">index</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;encoding/json&#34;</span>
	<span style="color:#e6db74">&#34;io/ioutil&#34;</span>
)

<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Index</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Docs</span>  []<span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">Words</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#66d9ef">bool</span>
}

<span style="color:#75715e">// Create a new empty index
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">New</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">Index</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Index</span>{}
}

<span style="color:#75715e">// Load an existing index from disk
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Load</span>(<span style="color:#a6e22e">path</span> <span style="color:#66d9ef">string</span>) (<span style="color:#f92672">*</span><span style="color:#a6e22e">Index</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadFile</span>(<span style="color:#e6db74">&#34;index.json&#34;</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">index</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Index</span>{}
	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Unmarshal</span>(<span style="color:#a6e22e">data</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">index</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">err</span>
}

<span style="color:#75715e">// Add a document to the index
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Index</span>) <span style="color:#a6e22e">AddDoc</span>(<span style="color:#a6e22e">url</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">words</span> []<span style="color:#66d9ef">string</span>) {
	<span style="color:#a6e22e">docId</span> <span style="color:#f92672">:=</span> len(<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Docs</span>)
	<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Docs</span> = append(<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Docs</span>, <span style="color:#a6e22e">url</span>)
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">word</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">words</span> {
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Words</span>[<span style="color:#a6e22e">word</span>]; !<span style="color:#a6e22e">ok</span> {
			<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Words</span>[<span style="color:#a6e22e">word</span>] = <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">int</span>]<span style="color:#66d9ef">bool</span>{<span style="color:#a6e22e">docId</span>: <span style="color:#66d9ef">true</span>}
			<span style="color:#66d9ef">continue</span>
		}
		<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Words</span>[<span style="color:#a6e22e">word</span>][<span style="color:#a6e22e">docId</span>] = <span style="color:#66d9ef">true</span>
	}
}

<span style="color:#75715e">// Retreive all documents that mention a word
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Index</span>) <span style="color:#a6e22e">GetDocs</span>(<span style="color:#a6e22e">word</span> <span style="color:#66d9ef">string</span>) []<span style="color:#66d9ef">string</span> {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Words</span>[<span style="color:#a6e22e">word</span>]; !<span style="color:#a6e22e">ok</span> {
		<span style="color:#66d9ef">return</span> []<span style="color:#66d9ef">string</span>{}
	}

	<span style="color:#a6e22e">docs</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">string</span>, <span style="color:#ae81ff">0</span>, len(<span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Words</span>[<span style="color:#a6e22e">word</span>]))
	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">id</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Words</span>[<span style="color:#a6e22e">word</span>] {
		<span style="color:#a6e22e">docs</span> = append(<span style="color:#a6e22e">docs</span>, <span style="color:#a6e22e">i</span>.<span style="color:#a6e22e">Docs</span>[<span style="color:#a6e22e">id</span>])
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">docs</span>
}

<span style="color:#75715e">// Save the index to disk
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Index</span>) <span style="color:#a6e22e">Save</span>() <span style="color:#66d9ef">error</span> {
	<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">json</span>.<span style="color:#a6e22e">Marshal</span>(<span style="color:#a6e22e">i</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
	}

	<span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">WriteFile</span>(<span style="color:#e6db74">&#34;index.json&#34;</span>, <span style="color:#a6e22e">data</span>, <span style="color:#ae81ff">0666</span>)
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
}
</code></pre></td></tr></table>
</div>
</div><p>Before moving on to the crawler, I want to mention that this simple index
has many drawbacks.</p>
<ul>
<li>
<p>The index cannot solve exact matches
(in Google this can be achieved to put double quotes around a phrase) as our
index doesn&rsquo;t save where words appear.</p>
</li>
<li>
<p>Saving the index as json is not
quite as efficient as it could be with a custom file format, but was used here
for simplicity.</p>
</li>
<li>
<p>The index is not scalable as whole thing has to fit into memmory, is at the
moment not thread-save and cannot easily be spread over multiple
processes/computers.</p>
</li>
<li>
<p>Every website is just represented by its URL, which means this is all we can
show the user as a result, no websites title, no sniped where the
searchterm appears just the URL.</p>
</li>
</ul>
<h1 id="the-crawler">The crawler<a hidden class="anchor" aria-hidden="true" href="#the-crawler">#</a></h1>
<p>Now that we have created the structure of the index, we need to write a program
to build said index. A <a href="https://en.wikipedia.org/wiki/Web_crawler">Web crawler</a>
starts at a website (this one is called the seed), downloads it, extracts all links to other websites,
adds them to a waitingqueue and then repeats with new URL from the queue.</p>
<p>This way of discovering new websites works quite well, actually it works too
good. For example the <a href="https://en.wikipedia.org/wiki/Linux">Linux Wikipedia</a>
page has over 1700 hyperlinks, if each of them has again 1700 links we would
have visited almost three milion websites. While this example might be somewhat
extreme, it shows the point that we need to limit the crawler artificially.</p>
<p>There are some quite creative ways to limit the crawler. For example we could
limit the websites we visited to a single URL like <code>bbc.com</code> or let the
crawler just allow to visit Austria domains which all end in <code>.at</code>.
For now, however, we will only limit the number of websited the crawler can visit.</p>
<p>So with that said our main loop looks something like that:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">// cmd/crawler/main.go
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">index</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">index</span>.<span style="color:#a6e22e">New</span>()
	<span style="color:#a6e22e">queue</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;https://en.wikipedia.org/wiki/Linux&#34;</span>}
	<span style="color:#a6e22e">visited</span> <span style="color:#f92672">:=</span> make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">bool</span>)
	<span style="color:#a6e22e">limit</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">100</span>
	<span style="color:#a6e22e">client</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Client</span>{
		<span style="color:#a6e22e">Timeout</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>,
	}

	<span style="color:#66d9ef">for</span> len(<span style="color:#a6e22e">visited</span>) &lt; <span style="color:#a6e22e">limit</span> <span style="color:#f92672">&amp;&amp;</span> len(<span style="color:#a6e22e">queue</span>) &gt; <span style="color:#ae81ff">0</span> {
		<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">queue</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">queue</span>[<span style="color:#ae81ff">0</span>], <span style="color:#a6e22e">queue</span>[<span style="color:#ae81ff">1</span>:]
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">visited</span>[<span style="color:#a6e22e">url</span>]; <span style="color:#a6e22e">ok</span> {
			<span style="color:#75715e">// already visited that url
</span><span style="color:#75715e"></span>			<span style="color:#66d9ef">continue</span>
		}

		<span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#a6e22e">url</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Unable to download %s: %s&#34;</span>, <span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">Error</span>())
			<span style="color:#66d9ef">continue</span>
		}
		<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>.<span style="color:#a6e22e">Close</span>()
		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;Downloaded %s&#34;</span>, <span style="color:#a6e22e">url</span>)

		<span style="color:#a6e22e">visited</span>[<span style="color:#a6e22e">url</span>] = <span style="color:#66d9ef">true</span>
		<span style="color:#a6e22e">links</span>, <span style="color:#a6e22e">words</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">extractData</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">resp</span>.<span style="color:#a6e22e">Body</span>)

		<span style="color:#a6e22e">index</span>.<span style="color:#a6e22e">addDoc</span>(<span style="color:#a6e22e">url</span>, <span style="color:#a6e22e">words</span>)
		<span style="color:#a6e22e">queue</span> = append(<span style="color:#a6e22e">queue</span>, <span style="color:#a6e22e">links</span><span style="color:#f92672">...</span>)
	}
}
</code></pre></td></tr></table>
</div>
</div><p>In this code snipet we used a new function we haven&rsquo;t talked about:
<code>extractData()</code>. This function extracts hyperlinks and text from a webpage.
Unfortunatly this means we need to parse HTML which is non-trivial and correct
parsing would exceed the limit of this blog. Luckily this problem is quite
common and there are libraries for almost any programming language that
can parse HTML:</p>
<ul>
<li><code>Golang</code>: <a href="https://github.com/PuerkitoBio/goquery">goquery</a></li>
<li><code>Python</code>: <a href="https://pypi.org/project/beautifulsoup4/">beautifulsoup4</a></li>
<li><code>Node.js</code>: <a href="https://github.com/jsdom/jsdom">jsdom</a></li>
<li><code>Rust</code>: <a href="https://github.com/servo/html5ever">html5ever</a></li>
</ul>
<p>If you cannot find a library or don&rsquo;t want to use the one, you can still
achive the most basic results with regular expressions.</p>
<p>With goquery the extract function the complete crawler looks something like
this:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Go" data-lang="Go"><span style="color:#75715e">// cmd/crawler/main.go
</span><span style="color:#75715e"></span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;io&#34;</span>
	<span style="color:#e6db74">&#34;log&#34;</span>
	<span style="color:#e6db74">&#34;net/http&#34;</span>
	<span style="color:#e6db74">&#34;net/url&#34;</span>
	<span style="color:#e6db74">&#34;strings&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>

	<span style="color:#e6db74">&#34;github.com/PuerkitoBio/goquery&#34;</span>
	<span style="color:#e6db74">&#34;github.com/flofriday/websearchblog/index&#34;</span> <span style="color:#75715e">// Change this line
</span><span style="color:#75715e"></span>)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">extractData</span>(<span style="color:#a6e22e">baseUrl</span> <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">body</span> <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Reader</span>) ([]<span style="color:#66d9ef">string</span>, []<span style="color:#66d9ef">string</span>) {
	<span style="color:#a6e22e">base</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#a6e22e">baseUrl</span>)
	<span style="color:#a6e22e">doc</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">goquery</span>.<span style="color:#a6e22e">NewDocumentFromReader</span>(<span style="color:#a6e22e">body</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> []<span style="color:#66d9ef">string</span>{}, []<span style="color:#66d9ef">string</span>{}
	}

	<span style="color:#a6e22e">links</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">string</span>{}
	<span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">Find</span>(<span style="color:#e6db74">&#34;a&#34;</span>).<span style="color:#a6e22e">Each</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">el</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">goquery</span>.<span style="color:#a6e22e">Selection</span>) {
		<span style="color:#a6e22e">href</span>, <span style="color:#a6e22e">exists</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">Attr</span>(<span style="color:#e6db74">&#34;href&#34;</span>)
		<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">exists</span> {
			<span style="color:#66d9ef">return</span>
		}
		<span style="color:#a6e22e">link</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">url</span>.<span style="color:#a6e22e">Parse</span>(<span style="color:#a6e22e">href</span>)
		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
			<span style="color:#66d9ef">return</span>
		}
		<span style="color:#a6e22e">link</span> = <span style="color:#a6e22e">base</span>.<span style="color:#a6e22e">ResolveReference</span>(<span style="color:#a6e22e">link</span>)
		<span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">Fragment</span> = <span style="color:#e6db74">&#34;&#34;</span>
		<span style="color:#a6e22e">links</span> = append(<span style="color:#a6e22e">links</span>, <span style="color:#a6e22e">link</span>.<span style="color:#a6e22e">String</span>())
	})

	<span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">Find</span>(<span style="color:#e6db74">&#34;script style&#34;</span>).<span style="color:#a6e22e">Each</span>(<span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">el</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">goquery</span>.<span style="color:#a6e22e">Selection</span>) {
		<span style="color:#a6e22e">el</span>.<span style="color:#a6e22e">Remove</span>()
	})

	<span style="color:#a6e22e">words</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">Fields</span>(<span style="color:#a6e22e">doc</span>.<span style="color:#a6e22e">Text</span>())
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">links</span>, <span style="color:#a6e22e">words</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#f92672">...</span>
}
</code></pre></td></tr></table>
</div>
</div><h1 id="the-webserver">The webserver<a hidden class="anchor" aria-hidden="true" href="#the-webserver">#</a></h1>
<h1 id="next-steps">Next steps<a hidden class="anchor" aria-hidden="true" href="#next-steps">#</a></h1>

</div>
  <footer class="post-footer">
  </footer>
</article>
    </main><footer class="footer">
    <span>&copy; 2021 <a href="http://flofriday.github.io">flofriday</a></span>
    <span>&middot;</span>
    <span>Powered by <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a></span>
    <span>&middot;</span>
    <span>Theme <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a></span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)">
    <button class="top-link" id="top-link" type="button" accesskey="g">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z" />
        </svg>
    </button>
</a>



<script defer src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<script>
    window.onload = function () {
        if (localStorage.getItem("menu-scroll-position")) {
            document.getElementById('menu').scrollLeft = localStorage.getItem("menu-scroll-position");
        }
    }
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

    function menu_on_scroll() {
        localStorage.setItem("menu-scroll-position", document.getElementById('menu').scrollLeft);
    }

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>

</body>

</html>
